



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Purely functional, Statically Typed Python">
      
      
        <link rel="canonical" href="https://pfun.dev/immutable_objects_and_data/">
      
      
      <link rel="shortcut icon" href="../nav_logo.svg">
      <meta name="generator" content="mkdocs-1.3.0, mkdocs-material-5.5.14">
    
    
      
        <title>Immutable Objects And Data Structures - pfun</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.d3202873.min.css">
      
        <link rel="stylesheet" href="../assets/stylesheets/palette.ff0a5ce4.min.css">
      
      
        
        
        <meta name="theme-color" content="#2094f3">
      
    
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
    
      
    
    
  </head>
  
  
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="blue" data-md-color-accent="">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#immutable" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href="https://pfun.dev/" title="pfun" class="md-header-nav__button md-logo" aria-label="pfun">
      
  <img src="../nav_logo.svg" alt="logo">

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      
        <div class="md-header-nav__ellipsis">
          <span class="md-header-nav__topic md-ellipsis">
            pfun
          </span>
          <span class="md-header-nav__topic md-ellipsis">
            
              Immutable Objects And Data Structures
            
          </span>
        </div>
      
    </div>
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active">
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header-nav__source">
        
<a href="https://github.com/suned/pfun" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    suned/pfun
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
        
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="https://pfun.dev/" title="pfun" class="md-nav__button md-logo" aria-label="pfun">
      
  <img src="../nav_logo.svg" alt="logo">

    </a>
    pfun
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/suned/pfun" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    suned/pfun
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-1" type="checkbox" id="nav-1" checked>
    
    <label class="md-nav__link" for="nav-1">
      Guide
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Guide" data-md-level="1">
      <label class="md-nav__title" for="nav-1">
        <span class="md-nav__icon md-icon"></span>
        Guide
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../what_is_this/" title="What Is This?" class="md-nav__link">
      What Is This?
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../install/" title="Install" class="md-nav__link">
      Install
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Immutable Objects And Data Structures
        <span class="md-nav__icon md-icon"></span>
      </label>
    
    <a href="./" title="Immutable Objects And Data Structures" class="md-nav__link md-nav__link--active">
      Immutable Objects And Data Structures
    </a>
    
      
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#immutable" class="md-nav__link">
    Immutable
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#list" class="md-nav__link">
    List
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dict" class="md-nav__link">
    Dict
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lens" class="md-nav__link">
    Lens
  </a>
  
</li>
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../useful_functions/" title="Useful Functions" class="md-nav__link">
      Useful Functions
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../effectful_but_side_effect_free/" title="Effectful (But Side-Effect Free) Programming" class="md-nav__link">
      Effectful (But Side-Effect Free) Programming
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../curried_and_typesafe_operators/" title="Curried And Type-Safe Operators" class="md-nav__link">
      Curried And Type-Safe Operators
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../stack_safety/" title="Stack-Safety And Recursion" class="md-nav__link">
      Stack-Safety And Recursion
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../property_based_testing/" title="Property-Based Testing" class="md-nav__link">
      Property-Based Testing
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../other_resources/" title="Other Resources" class="md-nav__link">
      Other Resources
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      API Reference
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="API Reference" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        <span class="md-nav__icon md-icon"></span>
        API Reference
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../pfun_api/" title="pfun" class="md-nav__link">
      pfun
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../functions_api/" title="pfun.functions" class="md-nav__link">
      pfun.functions
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../effect_api/" title="pfun.effect" class="md-nav__link">
      pfun.effect
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../schedule_api/" title="pfun.schedule" class="md-nav__link">
      pfun.schedule
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../state_api/" title="pfun.state" class="md-nav__link">
      pfun.state
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../console_api/" title="pfun.console" class="md-nav__link">
      pfun.console
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../files_api/" title="pfun.files" class="md-nav__link">
      pfun.files
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../clock_api/" title="pfun.clock" class="md-nav__link">
      pfun.clock
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../random_api/" title="pfun.random" class="md-nav__link">
      pfun.random
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../logging_api/" title="pfun.logging" class="md-nav__link">
      pfun.logging
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../subprocess_api/" title="pfun.subprocess" class="md-nav__link">
      pfun.subprocess
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../http_api/" title="pfun.http" class="md-nav__link">
      pfun.http
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../sql_api/" title="pfun.sql" class="md-nav__link">
      pfun.sql
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../list_api/" title="pfun.list" class="md-nav__link">
      pfun.list
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../dict_api/" title="pfun.dict" class="md-nav__link">
      pfun.dict
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../maybe_api/" title="pfun.maybe" class="md-nav__link">
      pfun.maybe
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../either_api/" title="pfun.either" class="md-nav__link">
      pfun.either
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../immutable_api/" title="pfun.immutable" class="md-nav__link">
      pfun.immutable
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../trampoline_api/" title="pfun.trampoline" class="md-nav__link">
      pfun.trampoline
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../hypothesis_strategies_api/" title="pfun.hypothesis_strategies" class="md-nav__link">
      pfun.hypothesis_strategies
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../operator_api/" title="pfun.operator" class="md-nav__link">
      pfun.operator
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../lens_api/" title="pfun.lens" class="md-nav__link">
      pfun.lens
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#immutable" class="md-nav__link">
    Immutable
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#list" class="md-nav__link">
    List
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dict" class="md-nav__link">
    Dict
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lens" class="md-nav__link">
    Lens
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                  
                
                
                  <h1>Immutable Objects And Data Structures</h1>
                
                <h2 id="immutable">Immutable</h2>
<p><code>Immutable</code> makes a class (and all classes that inherit from it) immutable. The syntax is much the same
as for <code>dataclass</code> or <code>NamedTuple</code>:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span> <span class="nn">pfun.immutable</span> <span class="kn">import</span> <span class="n">Immutable</span>


<span class="k">class</span> <span class="nc">C</span><span class="p">(</span><span class="n">Immutable</span><span class="p">):</span>
    <span class="n">a</span><span class="p">:</span> <span class="nb">int</span>


<span class="k">class</span> <span class="nc">D</span><span class="p">(</span><span class="n">C</span><span class="p">):</span>
    <span class="n">b</span><span class="p">:</span> <span class="nb">int</span>


<span class="n">c</span> <span class="o">=</span> <span class="n">C</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">c</span><span class="o">.</span><span class="n">a</span> <span class="o">=</span> <span class="mi">2</span>  <span class="c1"># raises: FrozenInstanceError</span>

<span class="n">d</span> <span class="o">=</span> <span class="n">D</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>  <span class="c1"># &#39;D&#39; inherits the members of C</span>
<span class="n">d</span><span class="o">.</span><span class="n">b</span> <span class="o">=</span> <span class="mi">2</span>  <span class="c1"># raises FrozenInstanceError</span>
</code></pre></div>

<p><code>Immutable</code> uses <a href="https://docs.python.org/3/library/dataclasses.html">dataclasses</a> under the hood, so for detailed
usage documentation, see the official docs. You can use the entire <code>dataclass</code> api.</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span> <span class="nn">dataclasses</span> <span class="kn">import</span> <span class="n">field</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Tuple</span>


<span class="k">class</span> <span class="nc">C</span><span class="p">(</span><span class="n">Immutable</span><span class="p">):</span>
    <span class="n">l</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">tuple</span><span class="p">)</span>


<span class="k">assert</span> <span class="n">C</span><span class="p">()</span><span class="o">.</span><span class="n">l</span> <span class="o">==</span> <span class="p">()</span>
</code></pre></div>

<p>In addition, if the <code>pfun</code> MyPy plugin is enabled, MyPy can check for assignments that will fail
at runtime.</p>
<h2 id="list">List</h2>
<p><code>List</code> is a functional style list data structure.</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span> <span class="nn">pfun.list</span> <span class="kn">import</span> <span class="n">List</span>


<span class="n">l</span> <span class="o">=</span> <span class="n">List</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span>
<span class="n">l2</span> <span class="o">=</span> <span class="n">l</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">l</span> <span class="o">==</span> <span class="n">List</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span> <span class="ow">and</span> <span class="n">l2</span> <span class="o">==</span> <span class="n">List</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">6</span><span class="p">))</span>
</code></pre></div>

<p>It supports the same operations as <code>list</code>, with the exception of <code>__setitem__</code>, which
will raise an Exception.</p>
<p>In addition, <code>List</code> supplies functional operations such as <code>map</code> and <code>reduce</code> as
instance methods</p>
<div class="codehilite"><pre><span></span><code><span class="k">assert</span> <span class="n">List</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span><span class="o">.</span><span class="n">reduce</span><span class="p">(</span><span class="k">lambda</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span>
<span class="k">assert</span> <span class="n">List</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span> <span class="o">==</span> <span class="p">[</span><span class="s1">&#39;0&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;2&#39;</span><span class="p">]</span>
</code></pre></div>

<h2 id="dict">Dict</h2>
<p><code>Dict</code> is a functional style dictionary.</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span> <span class="nn">pfun.dict</span> <span class="kn">import</span> <span class="n">Dict</span>
<span class="kn">from</span> <span class="nn">pfun.maybe</span> <span class="kn">import</span> <span class="n">Just</span>


<span class="n">d</span> <span class="o">=</span> <span class="n">Dict</span><span class="p">({</span><span class="s1">&#39;key&#39;</span><span class="p">:</span> <span class="s1">&#39;value&#39;</span><span class="p">})</span>
<span class="n">d2</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;new_key&#39;</span><span class="p">,</span> <span class="s1">&#39;new_value&#39;</span><span class="p">)</span>
<span class="k">assert</span> <span class="s1">&#39;new_key&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">d</span> <span class="ow">and</span> <span class="n">d2</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;new_key&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="n">Just</span><span class="p">(</span><span class="s1">&#39;new_value&#39;</span><span class="p">)</span>
</code></pre></div>

<p>It supports the same api as <code>dict</code> which the exception of <code>__setitem__</code> which will raise an exception, and uses
<code>pfun.maybe.Maybe</code> to indicate the presence or absence of a key when using <code>get</code>.</p>
<h2 id="lens">Lens</h2>
<p>Working with deeply nested immutable data-structures can be tricky when you want to transform only one member of an object deep inside the nested structure, but want to keep other the remaining data-structure intact, for example in:</p>
<div class="codehilite"><pre><span></span><code><span class="n">d</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;c&#39;</span><span class="p">:</span> <span class="s1">&#39;I want to change this...&#39;</span>
        <span class="p">}</span>
    <span class="p">},</span>
    <span class="s1">&#39;d&#39;</span><span class="p">:</span> <span class="s1">&#39;but not this&#39;</span>
<span class="p">}</span>


<span class="n">new_d</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">new_d</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">new_d</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">][</span><span class="s1">&#39;b&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">][</span><span class="s1">&#39;b&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">new_d</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">][</span><span class="s1">&#39;b&#39;</span><span class="p">][</span><span class="s1">&#39;c&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Phew! That took a lot of work!&#39;</span>
</code></pre></div>

<p>A <em>lens</em> is a setter function that takes as arguments a value to replace at some path/index
in an object/data-structure, and an object to transform. <code>pfun.lens</code> allows you
to easily construct these setter functions by specifying the path/index at
which you want to perform a replacement using normal Python indexing and attribute
access. You use the object returned by <code>lens()</code> as a proxy for the object you want
to transform by accessing attributes and indexes on it. The lens will remember this
path, and use it when performing an update. You perform an update by calling the lens
with the value to use as a replacement, and an object on which to perform the replacement:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span> <span class="nn">pfun</span> <span class="kn">import</span> <span class="n">lens</span>


<span class="n">t</span> <span class="o">=</span> <span class="n">lens</span><span class="p">()[</span><span class="s1">&#39;a&#39;</span><span class="p">][</span><span class="s1">&#39;b&#39;</span><span class="p">][</span><span class="s1">&#39;c&#39;</span><span class="p">]</span>
<span class="n">new_d</span> <span class="o">=</span> <span class="n">t</span><span class="p">(</span><span class="s1">&#39;Wow that was a lot easier!&#39;</span><span class="p">)(</span><span class="n">d</span><span class="p">)</span>
</code></pre></div>

<p>If you use the <code>pfun</code> MyPy plugin, you can give a type as an argument to <code>lens</code>, which allows MyPy to check that the operations you make on the lens object are supported by the type you intend to transform:</p>
<div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">Organization</span><span class="p">:</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>


<span class="k">class</span> <span class="nc">Person</span><span class="p">:</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>


<span class="k">class</span> <span class="nc">Employee</span><span class="p">(</span><span class="n">Person</span><span class="p">):</span>
    <span class="n">organization</span><span class="p">:</span> <span class="n">Organization</span>


<span class="n">e</span> <span class="o">=</span> <span class="n">lens</span><span class="p">(</span><span class="n">Employee</span><span class="p">)</span>

<span class="c1"># MyPy type error because we misspelled &#39;organization&#39;</span>
<span class="n">e</span><span class="o">.</span><span class="n">organisation</span><span class="p">(</span><span class="s1">&#39;Foo Inc&#39;</span><span class="p">)</span>

<span class="c1"># MyPy type error because &quot;Employee.name&quot; must be a &quot;str&quot;</span>
<span class="n">e</span><span class="o">.</span><span class="n">name</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

<span class="c1"># MyPy type error because &quot;Person&quot; is not an &quot;Employee&quot;</span>
<span class="n">e</span><span class="o">.</span><span class="n">organization</span><span class="o">.</span><span class="n">name</span><span class="p">(</span><span class="s1">&#39;Foo Inc&#39;</span><span class="p">)(</span><span class="n">Person</span><span class="p">())</span>
</code></pre></div>

<p>Since lenses are just Python callables, you can combine them using the normal
compose operations available in <code>pfun</code>:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span> <span class="nn">pfun</span> <span class="kn">import</span> <span class="n">compose</span>


<span class="n">e</span> <span class="o">=</span> <span class="n">lens</span><span class="p">(</span><span class="n">Employee</span><span class="p">)</span>
<span class="n">set_name</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="n">name</span>
<span class="n">set_org_name</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="n">organization</span><span class="o">.</span><span class="n">name</span>

<span class="n">new_user</span> <span class="o">=</span> <span class="n">compose</span><span class="p">(</span><span class="n">set_name</span><span class="p">(</span><span class="s1">&#39;Bob&#39;</span><span class="p">),</span> <span class="n">set_org_name</span><span class="p">(</span><span class="s1">&#39;Foo Inc&#39;</span><span class="p">))(</span><span class="n">Employee</span><span class="p">())</span>
</code></pre></div>

<p>Currently, <code>lens</code> supports working with the following types of objects and data-structures:</p>
<ul>
<li>Regular Python objects</li>
<li><code>collections.namedtuple</code> and <code>typing.NamedTuple</code> instances</li>
<li>normal and frozen <code>dataclasses.dataclass</code> and <code>pfun.Immutable</code></li>
<li><code>pfun.List</code>, <code>tuple</code> and <code>list</code></li>
<li><code>pfun.Dict</code> and <code>dict</code></li>
</ul>
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
      
    </div>
    
      <script src="../assets/javascripts/vendor.2d1db4bd.min.js"></script>
      <script src="../assets/javascripts/bundle.6627ddf3.min.js"></script><script id="__lang" type="application/json">{"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching"}</script>
      
      <script>
        app = initialize({
          base: "..",
          features: [],
          search: Object.assign({
            worker: "../assets/javascripts/worker/search.5eca75d3.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
    
  </body>
</html>